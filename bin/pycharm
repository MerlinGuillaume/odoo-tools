#!/usr/bin/fish

set workspaces (workspace -l)
set pycharm_bin (fd pycharm.sh ~/.local/share/JetBrains/Toolbox/apps/PyCharm-P/ch-0/*/bin | sort -r | head -n1)

if not test -f $pycharm_bin
    notify-send (basename $i)" moved"
    exit 1
end

function open
    setsid $pycharm_bin $argv &>/dev/null &
end

set choice (workspace -p)
if test $status -ne 0
    set width 0
    for i in $workspaces
        set width (math "max($width, $(string length --visible $i))")
    end
    set width (math "$width + 2")
    set lines (count $workspaces)
    set choice (echo $workspaces | string split ' ' | rofi -l $lines -dmenu -p pycharm -no-default-config -theme-str "window {width: $width ch;}")
end

if test -d "$choice"
    open $choice
else
    exit 1
end
