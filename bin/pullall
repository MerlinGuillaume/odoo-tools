#!/usr/bin/fish

function pull
  set repo $argv[1]
  set repo_version (workspace -v $repo)
  set branch (git -C $repo rev-parse --abbrev-ref HEAD)
  if test "$branch" = "$repo_version"
    git -C $argv[1] pull
  else
    set -ga skipped $argv[1]
  end
end

for i in (workspace -l)
  pull $i/enterprise
  pull $i/odoo
end

if set -q skipped
  echo
  echo (set_color red)Skipped(set_color normal) (string join ',' $skipped)
end
